name: Get Dropbox Refresh Token

on:
  workflow_dispatch:
    inputs:
      auth_code:
        description: 'Paste the Authorization Code from the browser here'
        required: true

jobs:
  exchange:
    runs-on: ubuntu-latest
    steps:
      - name: Exchange Code for Refresh Token
        run: |
          echo "Exchanging code..."
          RESPONSE=$(curl -s -X POST https://api.dropbox.com/oauth2/token \
            -u "${{ secrets.DROPBOX_APP_KEY }}:${{ secrets.DROPBOX_APP_SECRET }}" \
            -d grant_type=authorization_code \
            -d code=${{ github.event.inputs.auth_code }})
          
          # This will print the JSON to your logs
          echo "--- RESPONSE FROM DROPBOX ---"
          echo "$RESPONSE" | jq .
          echo "-----------------------------"
          
          echo "Look for 'refresh_token' in the JSON above."
